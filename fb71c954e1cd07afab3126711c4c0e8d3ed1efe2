{
  "comments": [
    {
      "key": {
        "uuid": "ae564743_a4bbc2dc",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 1
      },
      "lineNbr": 32,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-16T23:02:35Z",
      "side": 1,
      "message": "currently, I don\u0027t know what happens after that? In the auth url for Google I need to set a redirect url (where google should the user redirect after he\u0027s authenticated and allowed us to read the data). This is currently the Special:UserLogin url. This redirect url has a one-time access_token in the url, which needs to be set to the client in order to be able to access the users data.\n\nHowever, if I allow the application to read the data I get redirected to Special:UserLogin (with the access_token in the url), but unfortunately, AuthManager doesn\u0027t recognize this request as an already initiated authentication request and starts a new one (with the well-known form, where I could click \"login with google\" again).\n\nMaybe it\u0027s just too late and I don\u0027t see what I do false or I really don\u0027t see, what I need to do :/ Maybe someone can give a hint? :)",
      "revId": "fb71c954e1cd07afab3126711c4c0e8d3ed1efe2",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_44ec66b8",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 1
      },
      "lineNbr": 32,
      "author": {
        "id": 389
      },
      "writtenOn": "2016-05-16T23:29:34Z",
      "side": 1,
      "message": "Use $req-\u003ereturnToUrl (keep the query parameters it has and have Google add anything you need back from it). Instead of $req use something that can take an access_token (don\u0027t try to access the request directly; rememeber that this might happen through the API in which case $req-\u003ereturnToUrl will point to some third party site, or some URL capturable by a mobile app, in which case it\u0027s their responsibility to construct the AuthenticationRequest). See https://gerrit.wikimedia.org/r/#/c/251930/23/auth/OAuthPrimaryAuthenticationProvider.php for an example. (I wonder if a request type for an OAuth response is ubiquitous enough to be included in core.)",
      "parentUuid": "ae564743_a4bbc2dc",
      "revId": "fb71c954e1cd07afab3126711c4c0e8d3ed1efe2",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_f4c9e3ae",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 1
      },
      "lineNbr": 32,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-17T15:58:59Z",
      "side": 1,
      "message": "Uhh, that\u0027s really problematic, because the redirect uri for Google needs to be the same for all requests, e.g. Special:UserLogin. It\u0027s not possible to add (or even allow) parameters to the redirect uri or anything else, which is dynamic :(",
      "parentUuid": "ae564743_44ec66b8",
      "revId": "fb71c954e1cd07afab3126711c4c0e8d3ed1efe2",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_94e4e70b",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 1
      },
      "lineNbr": 32,
      "author": {
        "id": 389
      },
      "writtenOn": "2016-05-17T16:26:36Z",
      "side": 1,
      "message": "For web-based authentication, the return URL is Special:UserLogin/return; the problem is it requires a CSRF token, which is included in returnToUrl. Maybe we should allow providers to opt out from using a CSRF token, sounds a bit sketchy though.",
      "parentUuid": "ae564743_f4c9e3ae",
      "revId": "fb71c954e1cd07afab3126711c4c0e8d3ed1efe2",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_64840ad9",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 389
      },
      "writtenOn": "2016-05-16T23:29:34Z",
      "side": 1,
      "message": "How you use it is up to you. You should at least allow unlinking google accounts by returning one request for each linked account on ACTION_REMOVE, and then handling those requests here. This is also used for linking-on-login, but that\u0027s experimental and disabled by default. You can see an example at https://gerrit.wikimedia.org/r/#/c/251930/23/auth/OAuthPrimaryAuthenticationProvider.php",
      "revId": "fb71c954e1cd07afab3126711c4c0e8d3ed1efe2",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_d4c65f9c",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-17T15:58:59Z",
      "side": 1,
      "message": "ah, ok, thanks :)",
      "parentUuid": "ae564743_64840ad9",
      "revId": "fb71c954e1cd07afab3126711c4c0e8d3ed1efe2",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_244852ce",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 1
      },
      "lineNbr": 65,
      "author": {
        "id": 389
      },
      "writtenOn": "2016-05-16T23:29:34Z",
      "side": 1,
      "message": "More likely this is TYPE_LINK (are you actually creating a Google account?)",
      "revId": "fb71c954e1cd07afab3126711c4c0e8d3ed1efe2",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_34c07b7e",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 1
      },
      "lineNbr": 65,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-17T15:58:59Z",
      "side": 1,
      "message": "Ok, I thought it\u0027s meant, if I want to allow the creation of local wiki accounts based on the data from Google. But, of course, this extension doesn\u0027t create Google accounts.",
      "parentUuid": "ae564743_244852ce",
      "revId": "fb71c954e1cd07afab3126711c4c0e8d3ed1efe2",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}