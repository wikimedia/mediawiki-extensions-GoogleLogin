{
  "comments": [
    {
      "key": {
        "uuid": "ae564743_07c53964",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 55,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "Oh, one thing we forgot for this to work: this AuthenticationResponse needs a value for -\u003elinkRequest. See line 159 for details on what that value should be. Then providerChangeAuthenticationData() needs to accept that request and link the account.\n\nThen you should also put it in $response-\u003ecreateRequest too and have beginPrimaryAccountCreation() test for it and skip right to continuePrimaryAccountCreation() if it\u0027s present.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_c21e8fbd",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 55,
      "author": {
        "id": 389
      },
      "writtenOn": "2016-05-19T20:15:48Z",
      "side": 1,
      "message": "Note that this is disabled by default (see the comment on $wgAuthManagerAutoConfig in DefaultSettings.php).",
      "parentUuid": "ae564743_07c53964",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_c1732cae",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 55,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T21:59:14Z",
      "side": 1,
      "message": "Ok, I think I got it, but I unfortunately does not understand the part with the createRequest :/ I\u0027ll upload my changes so you see what I did, maybe I already did what you mean? :)\n\n@tgr: I assume that account creation after login with another provider isn\u0027t supported, yet, right? Because I\u0027ve the possiblility to login with a wiki account after successfully loggin in with a non-connected Google account, but I can\u0027t create a new account).\n\nBtw.: The interface message authprovider-confirmlink-failure-line is not defined: https://github.com/wikimedia/mediawiki/blob/1b855688586f29206a64eb975c2dd3d4e252ad84/includes/auth/ConfirmLinkSecondaryAuthenticationProvider.php#L137",
      "parentUuid": "ae564743_c21e8fbd",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_e75005db",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 73,
      "author": {
        "id": 389
      },
      "writtenOn": "2016-05-19T18:23:20Z",
      "side": 1,
      "message": "On remove, you should only return this if the account is actually linked. (Use $options[\u0027username\u0027] to check.)\n\nAlso, do you want to limit it to one account? (E.g. if I have a separate work and fun browser with different google accounts logged in, I could only log in in one of those.) If not, you should enumerate all linked accounts here.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_879dc95d",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 73,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T19:19:16Z",
      "side": 1,
      "message": "Currently you can have only one Google account connected with your wiki account, but your use case sounds valid, so I\u0027ll think about a 1:n relationship for wiki:google accounts. Thanks for the input!",
      "parentUuid": "ae564743_e75005db",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_073a5993",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 75,
      "author": {
        "id": 389
      },
      "writtenOn": "2016-05-19T18:23:20Z",
      "side": 1,
      "message": "requests have a $action property which will be set by the manager, you can use that instead of injecting the messages.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_6716b55b",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 75,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T19:19:16Z",
      "side": 1,
      "message": "I\u0027ll create a new AuthenticationRequest to handle these removes :)",
      "parentUuid": "ae564743_073a5993",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_27379dad",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 100,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "Shouldn\u0027t that be GoogleUser::newFromName( $username )-\u003eexists()?",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_dd502edb",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 100,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T21:59:14Z",
      "side": 1,
      "message": "Hmm, I expect that we run into this problem. GoogleUser seems to isn\u0027t what you expect that it is (I think the name is a bit confusing). It\u0027s a class that inherits from User and implements some methods around the \"normal\" MediaWiki User object. So, calling newFromName() would create a new User object and exists would check, if the user exists in the MediaWiki database.\n\nBut with this change, GoogleUser is minimized to what it needs to do (get Google account Ids connected with the User, connect and terminate connections). So, GoogleUser::newFromName() is unimplemented currently.",
      "parentUuid": "ae564743_27379dad",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_673d158a",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 106,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "That won\u0027t work. get_class( $req ) !\u003d\u003d GoogleAuthenticationRequest::class would probably be best.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_1d5e26ed",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 106,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T21:59:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ae564743_673d158a",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_470e11e9",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 114,
      "author": {
        "id": 389
      },
      "writtenOn": "2016-05-19T18:23:20Z",
      "side": 1,
      "message": "Was this meant to be newGood? Returning a fatal is better, it\u0027s unlikely that anything else would handle a GoogleAuthenticationRequest and the error message the user gets when everything ignores the request is less helpful than an \"account not linked\" error.\n\n(There should be no way for the user to trigger this if you don\u0027t return any requests on ACTION_REMOVE for unlinked accounts, but still.)",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_27903d4e",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 114,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T19:19:16Z",
      "side": 1,
      "message": "Ah, I missed to change this, thanks.",
      "parentUuid": "ae564743_470e11e9",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_a74a8d28",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 114,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "StatusValue::newFatal( \u0027ignored\u0027 ) isn\u0027t right. Either StatusValue::newGood( \u0027ignored\u0027 ), or pass a message key that exists to StatusValue::newFatal().",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_a176f89c",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 114,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T21:59:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ae564743_a74a8d28",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_c74b412a",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 119,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "(see line 106)",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_5d541ec9",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 119,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T21:59:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ae564743_c74b412a",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_47257155",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 120,
      "author": {
        "id": 389
      },
      "writtenOn": "2016-05-19T18:23:20Z",
      "side": 1,
      "message": "This method does not return anything currently (althogh see T132329); there is definitely no need to say if something is ignored. That\u0027s only used in Allows* to show an error if nothing denies but nothing is willing to accept either.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_4789f125",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 120,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T19:19:16Z",
      "side": 1,
      "message": "oops, copy-paste-error :/",
      "parentUuid": "ae564743_47257155",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_0761b9a3",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 120,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "This method isn\u0027t supposed to return anything.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_e16c70cd",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 120,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T21:59:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ae564743_0761b9a3",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_c7a34195",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 159,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "This isn\u0027t a good way to pass the data from continuePrimaryAccountCreation() to finishAccountCreation(). Instead, you should set $response-\u003elinkRequest.\n\nOption 1 is to use the same GoogleServerAuthenticationRequest that continuePrimaryAccountLink() accepts, and hope the re-authentication doesn\u0027t decide to suddenly fail. It would need a describeCredentials() method.\n\nOption 2 is to use something like this instead:\n\n class GoogleUserInfoAuthenticationRequest extends AuthenticationRequest {\n     public $required \u003d self::OPTIONAL;\n     public $userInfo;\n\n     public function getFieldInfo() {\n         return [];\n     }\n\n     public function describeCredentials() {\n         // return the same as GoogleAuthenticationRequest\n     }\n }\n\nThen you just pull out $response-\u003elinkRequest-\u003euserInfo and link it up without reauthenticating, just repeat the GoogleUser::isGoogleIdFree() check.\n\nThe only caveat is if $userInfo isn\u0027t serializable, then you\u0027d have to pull out just the bits you need instead of dumping the whole thing in there.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_41671ce6",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 159,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T21:59:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ae564743_c7a34195",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_8797894a",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 178,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "Throwing an exception is probably the best thing in this case.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_815db41c",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 178,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T21:59:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ae564743_8797894a",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_a783ad04",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 180,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "This method should return null explicitly.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_2162e8d4",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 180,
      "author": {
        "id": 890
      },
      "writtenOn": "2016-05-19T21:59:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ae564743_a783ad04",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae564743_a7f72d87",
        "filename": "includes/auth/GooglePrimaryAuthenticationProvider.php",
        "patchSetId": 7
      },
      "lineNbr": 204,
      "author": {
        "id": 221
      },
      "writtenOn": "2016-05-19T19:25:37Z",
      "side": 1,
      "message": "You seem to be repeating this same general code (lines 191â€“204) several times: here, in continuePrimaryAccountCreation(), and you\u0027ll probably need to do it again in providerChangeAuthenticationData(). It would probably be a good idea to move it out to a private method.",
      "revId": "414490875d39c5867b95532abe72b04630f6df86",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}